# 🏓 잉글리쉬 탁구 헌터 J - 게임 로직 문서

## 📋 목차
1. [게임 개요](#게임-개요)
2. [게임 모드](#게임-모드)
3. [스테이지 흐름](#스테이지-흐름)
4. [주요 시스템](#주요-시스템)
5. [컨트롤 시스템](#컨트롤-시스템)
6. [충돌 및 점수 시스템](#충돌-및-점수-시스템)

---

## 게임 개요

**장르**: 교육용 액션 아케이드 게임
**목표**: 20개 스테이지를 클리어하여 영어 제국 대마왕을 무찌르고 금메달 획득
**플레이어**: 지율이 (탁구 선수)
**테마**: 영어 단어 학습 + 탁구 액션

---

## 게임 모드

게임은 3가지 모드로 구성됩니다:

### 1. COLLECTING (알파벳 수집 모드)
- **목표**: 화면에 나타나는 알파벳 카드를 수집하여 목표 단어 완성
- **적**: 영어 제국 외계인 몬스터
- **무기**: 신검 (보라색 신성한 검)
- **게임플레이**:
  - 플레이어는 좌우상하로 자유롭게 이동
  - 스페이스바 or 신검 버튼으로 신검 발사
  - 올바른 알파벳에 맞추면 수집, 틀린 알파벳은 에너지 감소
  - 몬스터와 충돌하면 에너지 감소
  - 포션 획득 시 에너지 회복

### 2. QUIZ (퀴즈 모드 - 탁구채로 단어 맞추기)
- **목표**: 수집한 단어의 뜻을 4지선다 중에서 선택
- **무기**: 탁구채 + 탁구공
- **게임플레이**:
  - 지율이는 화면 왼쪽에 고정
  - 위/아래 방향키로 선택지 이동 (4개 선택지)
  - 스페이스바 or 탁구공 버튼으로 탁구공 발사
  - 탁구공이 선택지에 맞으면 답안 제출
  - **정답**: 파티클 효과 → 1초 후 다음 스테이지
  - **오답**: 에너지 -1, 공 리셋, 다시 도전

### 3. BOSS (보스전 모드)
- **발생 스테이지**: 5, 10, 15, 20
- **목표**: 보스를 탁구공으로 공격하여 체력을 0으로 만들기
- **게임플레이**:
  - 플레이어는 자유롭게 이동
  - 스페이스바 or 탁구공 버튼으로 탁구공 발사
  - 보스도 공을 발사하여 공격 (피하거나 맞으면 에너지 감소)
  - 보스 체력이 0이 되면 승리

---

## 스테이지 흐름

### 전체 게임 진행 (20 스테이지)

```
게임 시작
  ↓
오프닝 시퀀스 (스토리 애니메이션)
  ↓
[스테이지 1-4] ────────────────────────
│ 1. COLLECTING: 알파벳 수집          │
│ 2. QUIZ: 탁구채로 단어 맞추기      │
│ 3. 다음 스테이지                    │
└─────────────────────────────────────┘
  ↓
[스테이지 5] 보스전 🔥
  ↓
[스테이지 6-9] (위와 동일)
  ↓
[스테이지 10] 보스전 🔥
  ↓
[스테이지 11-14] (위와 동일)
  ↓
[스테이지 15] 보스전 🔥
  ↓
[스테이지 16-19] (위와 동일)
  ↓
[스테이지 20] 최종 보스전 🔥
  ↓
엔딩 시퀀스 → HAPPY ENDING! 🎉
```

### 일반 스테이지 상세 흐름

```
startStage(stageNum)
  ↓
startCollectingStage()
  │
  ├─ 게임 모드: GAME_MODE.COLLECTING
  ├─ 스테이지 단어 설정 (20개 중 1개)
  ├─ 플레이어 위치 초기화
  ├─ 알파벳 카드 생성 (spawnNextLetter)
  ├─ 몬스터 스폰 (180프레임마다)
  └─ 포션 스폰 (600프레임마다)

  [플레이어가 알파벳 수집]

  ↓ (모든 알파벳 수집 완료)

startQuizStage()
  │
  ├─ 게임 모드: GAME_MODE.QUIZ
  ├─ 지율이 위치: 왼쪽 고정, 첫 번째 선택지
  ├─ 퀴즈 선택지 생성 (4개: 정답 1 + 오답 3)
  ├─ 탁구공 초기화
  └─ UI 업데이트 (버튼: 신검 숨김, 탁구공 표시)

  [플레이어가 탁구공 발사]

  ↓ (선택지에 맞춤)

handleQuizAnswer(choice)
  │
  ├─ 정답인가?
  │   ├─ YES → 파티클 효과 → stageCleared()
  │   │                      ↓
  │   │                   다음 스테이지 or 게임 클리어
  │   │
  │   └─ NO → 에너지 -1 → 공 리셋 → 다시 도전
  │          (에너지 0이면 게임 오버)
  └─
```

### 보스 스테이지 흐름

```
startStage(5 or 10 or 15 or 20)
  ↓
isBossStage() → true
  ↓
startBossStage()
  │
  ├─ 게임 모드: GAME_MODE.BOSS
  ├─ 보스 생성 (체력: 스테이지별 다름)
  ├─ 탁구공 초기화
  ├─ 대화 시작 (보스 등장 대사)
  └─ UI 업데이트

  [플레이어가 보스와 전투]

  ↓ (보스 체력 0)

hitBoss() → boss.health <= 0
  │
  ├─ 보스 제거
  ├─ 대화 시작 (보스 패배 대사)
  └─ bossClearedStage()
      ↓
    다음 스테이지 or 게임 클리어
```

---

## 주요 시스템

### 1. 에너지 시스템
- **초기 에너지**: 10
- **최대 에너지**: 10
- **에너지 감소 원인**:
  - 틀린 알파벳 수집: -1
  - 몬스터 충돌: -1
  - 퀴즈 오답: -1
  - 보스 공격에 맞음: -1
- **에너지 회복**:
  - 포션 획득: +1
- **에너지 0 → 게임 오버**

### 2. 단어 선택 시스템
- `initGame()` 호출 시 20개 단어 랜덤 선택
- `getRandomWords(20)` 함수 사용 (words.js)
- 각 스테이지는 순서대로 단어 사용

### 3. 퀴즈 선택지 생성
- `createQuizChoices()` 함수
- `getQuizChoices(wordData)` 호출 (words.js)
  - 정답: 현재 단어의 뜻
  - 오답: 다른 단어의 뜻 3개 (랜덤)
- 4개 선택지를 랜덤 셔플하여 배치
- **화면 회전 시 자동으로 재생성** (멀티터치 지원)

### 4. 스크롤 시스템
- 배경과 오브젝트가 오른쪽에서 왼쪽으로 스크롤
- 스크롤 속도: `gameState.scrollSpeed = 1.5` (쉬운 난이도)
- 알파벳, 몬스터, 포션 모두 스크롤 영향 받음

---

## 컨트롤 시스템

### PC 컨트롤
- **이동**: 방향키 or WASD
- **신검 발사**: 스페이스바 (연타 가능, 쿨다운 15프레임)
- **탁구공 발사**: 스페이스바 (퀴즈/보스 모드)
- **대화 진행**: 스페이스바 or 엔터

### 모바일 컨트롤 (멀티터치 지원)
- **이동**: 왼쪽 조이스틱
  - 터치 ID 추적으로 독립적인 멀티터치 지원
  - 다른 버튼 터치와 간섭 없음
- **신검 발사**: 오른쪽 신검 버튼 (수집 모드에서 표시)
  - 터치 ID 추적으로 조이스틱과 동시 사용 가능
- **탁구공 발사**: 오른쪽 탁구공 버튼 (퀴즈/보스 모드에서 표시)
  - 터치 ID 추적으로 조이스틱과 동시 사용 가능

### 멀티터치 처리
각 컨트롤(조이스틱, 신검 버튼, 탁구공 버튼)은 독립적인 `touchId`를 가지고 추적:
- `joystick.touchId`: 조이스틱 터치 추적
- `swordBtnTouchId`: 신검 버튼 터치 추적
- `ballBtnTouchId`: 탁구공 버튼 터치 추적

**모든 조합 정상 작동**:
- 조이스틱 + 신검 버튼 동시
- 조이스틱 → 신검 추가
- 신검 → 조이스틱 추가
- 어떤 순서로 떼도 정상

---

## 충돌 및 점수 시스템

### 충돌 감지

#### 1. 신검 ↔ 알파벳
```javascript
// 각 신검에 대해 알파벳 카드와 충돌 체크
divineSwords.forEach(sword => {
    letters.forEach(letter => {
        if (checkCollision(sword, letter)) {
            if (isCorrectLetter) {
                // 수집 성공
            } else {
                // 에너지 감소
            }
        }
    });
});
```

#### 2. 플레이어 ↔ 몬스터
```javascript
monsters.forEach(monster => {
    if (monster.checkCollision(player)) {
        loseEnergy();
        // 몬스터 제거
    }
});
```

#### 3. 탁구공 ↔ 퀴즈 선택지
```javascript
ball.checkChoiceCollision(choice) {
    return ball.x > choice.x &&
           ball.x < choice.x + choice.width &&
           ball.y - ball.radius < choice.y + choice.height &&
           ball.y + ball.radius > choice.y;
}
```

#### 4. 탁구공 ↔ 보스
```javascript
ball.checkBossCollision() {
    return ball.x > boss.x &&
           ball.x < boss.x + boss.width &&
           ball.y - ball.radius < boss.y + boss.height &&
           ball.y + ball.radius > boss.y;
}
```

### 점수 시스템
- **점수 개념 없음** (스테이지 진행 방식)
- **진행도**: `gameState.clearedStages` (클리어한 스테이지 수)
- **목표**: 20 스테이지 모두 클리어

---

## 화면 크기 및 반응형

### 화면 크기 조정
- `resizeCanvas()`: 캔버스를 컨테이너 크기에 맞춤
- 화면 회전 시 자동 호출
- **퀴즈 모드에서 화면 회전 시**:
  - 선택지 위치/크기 자동 재계산
  - 지율이 위치 재조정
  - 탁구공 위치 재조정

### 모바일 최적화
- **가로 모드 전용**: 세로 모드에서는 회전 안내 표시
- **Safe Area 지원**: 노치/홈 버튼 영역 고려
- **퀴즈 선택지 크기 자동 조정**:
  - 화면 높이에 맞게 간격 계산: `Math.min(70, (canvas.height - 80) / 4)`
  - 박스 높이 조정: `Math.min(60, (canvas.height - 80) / 5)`
  - 폰트 크기 조정: `Math.min(12, boxHeight * 0.25)`

---

## 주요 함수 참조

### 게임 초기화
- `initGame()`: 게임 초기화, 20개 단어 선택
- `startStage(stageNum)`: 스테이지 시작
- `startCollectingStage()`: 알파벳 수집 모드 시작
- `startQuizStage()`: 퀴즈 모드 시작
- `startBossStage()`: 보스 모드 시작

### 게임 진행
- `updatePlayer()`: 플레이어 이동 처리
- `updateJiyulQuiz()`: 퀴즈 모드 지율이 위/아래 이동
- `launchDivineSwords()`: 신검 발사
- `launchBall()`: 탁구공 발사
- `checkCollisions()`: 충돌 감지 (수집 모드)

### 퀴즈 시스템
- `createQuizChoices()`: 4지선다 선택지 생성
- `handleQuizAnswer(choice)`: 답안 처리
  - 정답: `stageCleared()` 호출
  - 오답: 에너지 감소, 공 리셋

### 보스 시스템
- `hitBoss()`: 보스에게 데미지
- `bossClearedStage()`: 보스 클리어

### UI 업데이트
- `updateUI()`: 스테이지/단어/에너지 표시
- `updateEnergyDisplay()`: 하트 UI 업데이트
- `updateActionButtons()`: 버튼 표시/숨김

### 게임 종료
- `gameWin()`: 게임 클리어 (엔딩)
- `gameOver()`: 게임 오버
- `restartGame()`: 게임 재시작

---

## 디버깅 포인트

### 주요 상태 변수
- `gameState.mode`: 현재 게임 모드 (COLLECTING/QUIZ/BOSS)
- `gameState.currentStage`: 현재 스테이지 (1~20)
- `gameState.energy`: 현재 에너지 (0~10)
- `gameState.isRunning`: 게임 실행 중 여부
- `dialogueState.active`: 대화 중 여부 (true일 때 게임 일시정지)

### 콘솔 로그
- 퀴즈 모드 진입 시: "Quiz mode - class added to wordProgress"
- 보스 모드 진입 시: "Boss mode - class added to wordProgress"

---

## 버전 정보

**최종 수정일**: 2025-01-04
**주요 수정사항**:
- 멀티터치 지원 추가 (조이스틱 + 버튼 동시 사용)
- 화면 회전 시 퀴즈 선택지 자동 재계산
- 퀴즈 오답 시 공 리셋 버그 수정 (paddle 변수 오류)
- 가로 모드 화면 크기 최적화 (4개 박스 모두 표시)
- 버튼 위치 오른쪽으로 이동

---

**제작**: Claude Code
**게임 디자인**: 지율이를 위한 교육용 게임
